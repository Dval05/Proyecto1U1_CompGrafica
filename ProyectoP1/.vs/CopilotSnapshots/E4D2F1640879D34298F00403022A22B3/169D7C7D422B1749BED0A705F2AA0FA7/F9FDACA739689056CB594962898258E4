using System;
using System.Collections.Generic;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace ProyectoP1
{
    internal class CGema
    {
        // Datos Miembro (Atributos).

        // Lado del decágono.
        private float side;
        // Segmentos del decágono.
        private float a, b, c, d;
        // Ángulos del decágono.
        private float angle1, angle2;
        // Objeto que activa el modo gráfico.
        private Graphics graph;
        SolidBrush whiteBrush;
        // Objeto bolígrafo para dibujar en un lienzo.
        private Pen pen;
        // Constante scale factor (Zoom In/Zoom Out).
        public float SF;
        // Objeto Punto que representa a los diez vértices del decágono interior.
        private PointF A, B, C, D, E, F, G, H, I, J, O;
        // Objeto Punto que representa a los diez vértices del decágono interior.
        private PointF A2, B2, C2, D2, E2, F2, G2, H2, I2, J2;
        // Objeto Punto que representa a los vértices de pentagono interior.
        private PointF K, M, N, P, Q, R, S, T, U, V;
        // Objeto Punto que representa a los vértices al interior de la estrella mayor.
        private PointF A1, B1, C1, D1, E1;
        private PointF Ks, Ms, Ns, Ps, Qs, Rs, Ss, Ts, Us, Vs;
        private PointF Ki, Mi, Ni, Pi, Qi, Ri, Si, Ti, Ui, Vi;
        // Objeto Punto que representa a los vértices las linas interiores.
        private PointF P1, P2, P3, P4, P5, P6, P7, P8, P9, P10;
        private PointF P11, P12, P13, P14, P15, P16, P17, P18, P19, P20;
        private PointF P21, P22, P23, P24, P25;


        public CGema()
        {
            side = 0.0f;
            SF = 1.0f;
        }

        public bool ReadData(TextBox txtSide)
        {
            bool respuesta = true;
            try
            {
                side = float.Parse(txtSide.Text);
                if (side <= 0.0f)
                {
                    throw new Exception();
                }
            }
            catch
            {
                respuesta = false;
                MessageBox.Show("Ingrese Datos válidos...!", "ERROR!");
            }

            return respuesta;
        }

        public void InitializeData(TextBox txtSide, PictureBox picCanvas)
        {
            side = 0.0f;
            txtSide.Text = "";
            txtSide.Focus();
            picCanvas.Refresh();
        }

        public void DibujarGema(PictureBox picCanvas, CTransformation transform)
        {
            if (side <= 0)
            {
                MessageBox.Show("Por favor, ingrese un valor válido para la altura de la gema.");
                return;
            }

            // Asegurar que haya un Bitmap persistente en el PictureBox
            if (picCanvas.Image == null || picCanvas.Image.Width != picCanvas.Width || picCanvas.Image.Height != picCanvas.Height)
            {
                picCanvas.Image?.Dispose();
                picCanvas.Image = new Bitmap(Math.Max(1, picCanvas.Width), Math.Max(1, picCanvas.Height));
            }

            using (Graphics g = Graphics.FromImage(picCanvas.Image))
            {
                g.Clear(Color.White);
                g.SmoothingMode = SmoothingMode.AntiAlias;

                // Guardar estado antes de aplicar transformaciones
                GraphicsState state = g.Save();

                if (transform != null)
                {
                    transform.ApplyTransforms(g);
                }

                // Calcular el centro
                PointF centro = (transform == null) 
                    ? new PointF(picCanvas.Width / 2, picCanvas.Height / 2) 
                    : new PointF(0, 0);

                pen = new Pen(Color.Black, 2);

                // TODO: Implementar nuevo método de dibujo aquí

                g.Restore(state);
            }
            picCanvas.Refresh();
        }

        public void CloseForm(Form form)
        {
            form.Close();
        }
    }
}
